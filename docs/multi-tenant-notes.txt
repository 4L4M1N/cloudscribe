Multi-Tenant Support

Two mutually exclusive models are supported, Host Name based or Folder based, you can use one or the other for a given installation.
In all cases the first site created is considered the master site, in the database it has the field IsServerAdminSite set to true, and it can create new "child" sites as well as manage their settings.

There is also a "Related Sites Mode" setting, that can be enabled where the users and roles attached to one site will be used by all the sites in the installation.

Host Name Sites

The SiteId is resolved by the host name, ie somedomain.com is one host name and www.somedomain.com is another host name, you can map one or more host names to any given site. Any host names that are not mapped to a specific site are, mapped to the default site, ie the server admin site.
Typically for SEO you don't want duplicate content at different host names, so the notion of a preferred host name is also supported so that if a site is handling multiple host names you can redirect all of them to the preferred one. ie you may prefer somedomain.com vs www.somedomain.com and you can redirect requests for www.somedomain.com to somedomain.com if that is your preferred host name.

For a given domain name you can create as many host name DNS "a" records as you like host1.somedomain.com, host2.somedomain.com, cheeseburger.somedomain.com orwhatever.somedomain.com. 

You can create separate new sites using those host names all in a single installation of cloudscribe, you create the site and assign the host name mapping. 

Of course the ip address for the host name a record must be the ip address where the site is runnning, and if it is a shared ip address then you must also have a host name header added to the site in IIS so that IIS will hand the request to the correct site.

This need for creating DNS host names and host header mappings in IIS means that a technical person has to be involved when setting up a new site; non technical people cannot easily provision a new site in this model.

Folder Name Sites

The siteid is resolved by the first folder segment in the url, except for the first site which "must" be a root level site in IIS. The fist site created during setup is the server admin site and it does not have any folder mappings assigned to it and it must run as a root level IIS site in order to resolve the child site ids correctly form the first url segment.

ie the master site must work with an url like
somedomain.com/ or www.somedomain.com/
and then child sites can be created with urls like:
somedomain.com/site2/
somedomain.com/foo/
somedomain.com/cheeseburger/
somedoamin.com/whatever/

again for SEO reasons you should only use one folder mapping per site so that the content is not duplicated at different urls.

Folder based child sites are easier to provision, but they only work correctly with related sites mode where one set of users and roles is used for all sites. It is very useful for sites that are like sections of one site.

The technical reason that folder based child sites must use the same users is because they all use the same authentication cookie and the user id is stored in the cookie and used by the identity system to lookup the user on subsequent requests. So logging into differnet child sites would overwrite the cookie from the root site or other child sites and even if the user has an account in each site the user id would be different per site which would result in errors.

One possible way this could be solved would be to de-couple users from sites and have a joining table that connected userids to sites but this would be a major change in terms of effort and could impact peroformance a little and it would be impossible then to have a different user profile per site.

