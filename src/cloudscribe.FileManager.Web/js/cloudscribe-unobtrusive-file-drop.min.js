!function(){document.addEventListener("DOMContentLoaded",function(){for(var e=document.querySelectorAll("[data-dropzone]"),t='<div class="dz-preview dz-file-preview"><div class="dz-image"><img data-dz-thumbnail /></div><div class="dz-details collapse"><div class="dz-size collapse"><span data-dz-size></span></div><div class="dz-filename collapse"><span data-dz-name></span></div></div><div class="dz-progress collapse"><span class="dz-upload" data-dz-uploadprogress></span></div><div class="dz-error-message collapse"><span data-dz-errormessage></span></div><div class="dz-success-mark collapse"></div><div class="dz-error-mark collapse"></div></div>',i={openServerBrowser:function(e){$("#fileBrowseDialog").find("iframe").attr("src",e),$("#fileBrowseDialog").modal("show")},closeServerBrowser:function(){$("#fileBrowseDialog").modal("hide")},buildImageEditor:function(e){var t={dropZoneDiv:e,setupCropper:function(){var e=new Number(this.dropZoneDiv.dataset.resizeWidth),t=new Number(this.dropZoneDiv.dataset.resizeHeight),i={viewport:{width:e,height:t},boundary:{width:e,height:t}}
this.cropper=new Croppie(this.fullSizeImage,i)
var d=document.getElementById(this.dropZoneDiv.id+"-save-crop")
if(d){var s=this
d.classList.remove("collapse"),d.onclick=function(){if(s.cropper){var e=s.cropper.get(),t=new Number(e.points[0]),i=new Number(e.points[1]),d=new Number(e.points[2]),r=new Number(e.points[3]),a=d-t,o=r-i,n=new FormData
n.append("sourceFilePath",s.fullSizeInput.value),n.append("x1",t),n.append("y1",i),n.append("widthToCrop",a),n.append("heightToCrop",o),n.append("finalWidth",s.dropZoneDiv.dataset.resizeWidth),n.append("finalHeight",s.dropZoneDiv.dataset.resizeHeight),$.ajax({type:"POST",processData:!1,contentType:!1,headers:{"X-CSRFToken":s.dropZoneDiv.dataset.antiForgeryToken},dataType:"json",url:s.dropZoneDiv.dataset.fileCropUrl,data:n}).done(function(e,t,i){s.handleCropResult(e)}).fail(function(e,t,i){alert(t)})}}}},destroyCropper:function(){if(this.cropper){this.cropper.destroy(),this.cropper=void 0
var e=document.getElementById(this.dropZoneDiv.id+"-save-crop")
e&&e.classList.add("collapse")}},clearInputs:function(){this.dropZoneDiv.dataset.targetFullsizeInputId&&(this.fullSizeInput=document.getElementById(this.dropZoneDiv.dataset.targetFullsizeInputId),this.fullSizeInput.value=""),this.dropZoneDiv.dataset.targetResizedInputId&&(this.resizedInput=document.getElementById(this.dropZoneDiv.dataset.targetResizedInputId),this.resizedInput.value=""),this.dropZoneDiv.dataset.targetThumbInputId&&(this.thumbInput=document.getElementById(this.dropZoneDiv.dataset.targetThumbInputId),this.thumbInput.value="")},handleCropResult:function(e){this.destroyCropper(),this.fullSizeImage.src=e.resizedUrl,this.resizedInput.value=e.resizedUrl},serverFileSelected:function(e){this.destroyCropper(),this.clearInputs(),this.dropZoneDiv.dataset.targetFullsizeImageId&&(this.fullSizeImage=document.getElementById(this.dropZoneDiv.dataset.targetFullsizeImageId),this.fullSizeImage.src=e),this.dropZoneDiv.dataset.targetResizedImageId&&(this.resizedImage=document.getElementById(this.dropZoneDiv.dataset.targetResizedImageId),this.resizedImage.src=e),this.dropZoneDiv.dataset.targetFullsizeInputId&&(this.fullSizeInput=document.getElementById(this.dropZoneDiv.dataset.targetFullsizeInputId),this.fullSizeInput.value=e),this.dropZoneDiv.dataset.targetResizedInputId&&(this.resizedInput=document.getElementById(this.dropZoneDiv.dataset.targetResizedInputId),this.resizedInput.value=e),i.closeServerBrowser()},dropZoneAddedFile:function(e){this.cropper&&this.destroyCropper()},dropZoneSending:function(t,i,d){this.dropZoneDiv.dataset.resizeWidth&&this.dropZoneDiv.dataset.resizeHeight&&(d.append("maxWidth",this.dropZoneDiv.dataset.resizeWidth),d.append("maxHeight",this.dropZoneDiv.dataset.resizeHeight)),"false"==this.dropZoneDiv.dataset.resizeImage&&d.append("resizeImage",!1),this.dropZoneDiv.dataset.targetPath&&d.append("targetPath",this.dropZoneDiv.dataset.targetPath),"true"==e.dataset.createThumb&&d.append("createThumbnail",this.dropZoneDiv.dataset.createThumb)},dropZoneSuccess:function(e,t){this.dropZone&&this.dropZone.removeFile(e)
var i=t[0].originalUrl,d=t[0].resizedUrl,s=t[0].thumbUrl
this.resizedImage=this.dropZoneDiv.getElementsByTagName("img")[0],this.resizedImage?this.resizedImage.src=d:this.dropZoneDiv.dataset.targetResizedImageId&&(this.resizedImage=document.getElementById(this.dropZoneDiv.dataset.targetResizedImageId),this.resizedImage&&(this.resizedImage.src=d)),this.dropZoneDiv.dataset.targetThumbImageId&&(this.thumbImage=document.getElementById(this.dropZoneDiv.dataset.targetThumbImageId),this.thumbImage&&(this.thumbImage.src=s)),this.dropZoneDiv.dataset.targetFullsizeImageId&&(this.fullSizeImage=document.getElementById(this.dropZoneDiv.dataset.targetFullsizeImageId),this.fullSizeImage&&(this.fullSizeImage.src=i,"true"==this.dropZoneDiv.dataset.enableCrop&&this.setupCropper())),this.dropZoneDiv.dataset.targetFullsizeInputId&&(this.fullSizeInput=document.getElementById(this.dropZoneDiv.dataset.targetFullsizeInputId),this.fullSizeInput&&(this.fullSizeInput.value=i)),this.dropZoneDiv.dataset.targetResizedInputId&&(this.resizedInput=document.getElementById(this.dropZoneDiv.dataset.targetResizedInputId),this.resizedInput&&(this.resizedInput.value=d)),this.dropZoneDiv.dataset.targetThumbInputId&&(this.thumbInput=document.getElementById(this.dropZoneDiv.dataset.targetThumbInputId),this.thumbInput&&(this.thumbInput.value=s))},dropZoneError:function(e,t){console.log(t)}}
if(t.dropZone=this._buildDropZone(t,t.dropZoneDiv),e.dataset.fileBrowseUrl&&"true"==e.dataset.enableBrowseServer){var d=document.getElementById(e.id+"-browse-server")
d&&(d.classList.remove("collapse"),d.onclick=function(){i.openServerBrowser(e.dataset.fileBrowseUrl),window.FileSelectCallback=function(e){t.serverFileSelected(e)}})}return t},_buildDropZone:function(e,i){var d=new Dropzone("#"+i.id,{url:i.dataset.uploadUrl,method:"post",headers:{"X-CSRFToken":i.dataset.antiForgeryToken},maxFiles:1,acceptedFiles:i.dataset.acceptedFiles,previewTemplate:t,createImageThumbnails:!1,clickable:!0})
return d.on("addedfile",function(t){e.dropZoneAddedFile&&e.dropZoneAddedFile(t),window.DropZoneAddedFileHandler&&window.DropZoneAddedFileHandler(t)}),d.on("sending",function(t,i,d){e.dropZoneSending&&e.dropZoneSending(t,i,d),window.DropZoneSendingHandler&&window.DropZoneSendingHandler(t,i,d)}),d.on("success",function(t,i){e.dropZoneSuccess&&e.dropZoneSuccess(t,i),window.DropZoneSuccessHandler&&window.DropZoneSuccessHandler(t,i)}),d.on("error",function(t,i){e.dropZoneError&&e.dropZoneError(t,i),window.DropZoneErrorHandler&&window.DropZoneErrorHandler(t,i)}),d}},d=0;d<e.length;d++){var s=e[d]
i.buildImageEditor(s)}})}()
